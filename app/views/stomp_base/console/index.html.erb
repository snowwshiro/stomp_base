<div style="margin-bottom: 2rem;">
  <h1 style="color: #2c3e50; margin-bottom: 0.5rem;"><%= t('stomp_base.console.title') %></h1>
  <div style="background: #fff3cd; color: #856404; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
    <strong><%= t('stomp_base.console.warning') %>:</strong> <%= t('stomp_base.console.warning_message') %>
  </div>
</div>

<div style="background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden;">
  <div style="background: #2c3e50; color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center;">
    <span><%= t('stomp_base.console.environment') %>: <strong><%= Rails.env %></strong></span>
    <button onclick="clearConsole()" style="background: #e74c3c; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
      <%= t('stomp_base.console.clear') %>
    </button>
  </div>
  
  <div style="padding: 2rem;">
    <textarea id="console-input" 
              placeholder="<%= t('stomp_base.console.placeholder') %>" 
              style="width: 100%; height: 200px; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; font-family: 'Monaco', 'Consolas', monospace; font-size: 14px; resize: vertical;"></textarea>
    
    <div style="margin: 1rem 0; display: flex; gap: 1rem;">
      <button onclick="executeCode()" class="btn btn-primary">
        <%= t('stomp_base.console.execute') %>
      </button>
      <button onclick="clearInput()" class="btn btn-secondary">
        <%= t('stomp_base.console.clear') %>
      </button>
    </div>
    
    <div id="console-output" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 1rem; min-height: 200px; font-family: 'Monaco', 'Consolas', monospace; font-size: 14px; overflow-y: auto; white-space: pre-wrap;"></div>
  </div>
</div>

<script>
function executeCode() {
  const input = document.getElementById('console-input');
  const output = document.getElementById('console-output');
  const code = input.value.trim();
  
  if (!code) return;
  
  const timestamp = new Date().toLocaleTimeString();
  output.innerHTML += `\n[${timestamp}] > ${code}\n`;
  
  fetch('<%= stomp_base.console_path %>', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
    },
    body: JSON.stringify({ code: code })
  })
  .then(response => response.json())
  .then(data => {
    if (data.error) {
      output.innerHTML += `[ERROR] ${data.error}\n`;
    } else {
      output.innerHTML += `${data.result}\n`;
    }
    output.scrollTop = output.scrollHeight;
  })
  .catch(error => {
    output.innerHTML += `[ERROR] ${error.message}\n`;
    output.scrollTop = output.scrollHeight;
  });
}

function clearInput() {
  document.getElementById('console-input').value = '';
}

function clearConsole() {
  document.getElementById('console-output').innerHTML = '';
}

// Execute on Enter key
document.getElementById('console-input').addEventListener('keydown', function(e) {
  if (e.ctrlKey && e.key === 'Enter') {
    executeCode();
  }
});
</script>

<style>
  .btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 4px;
    text-decoration: none;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  
  .btn-primary {
    background: #3498db;
    color: white;
  }
  
  .btn-primary:hover {
    background: #2980b9;
  }
  
  .btn-secondary {
    background: #6c757d;
    color: white;
  }
  
  .btn-secondary:hover {
    background: #5a6268;
  }
</style>
